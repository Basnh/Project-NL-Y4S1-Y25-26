<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ƒêi·ªÅu khi·ªÉn M√°y ·∫¢o VirtualBox</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/layout.css">
</head>
<body class="bg-gray-100 font-sans antialiased min-h-screen flex flex-col">
    <!-- Main content wrapper -->
    <main class="flex-1">
        <div class="container mx-auto px-4 py-8">
            <div class="max-w-4xl mx-auto">
                <!-- Header -->
                <div th:replace="~{fragments/header :: header('ƒêi·ªÅu khi·ªÉn m√°y ·∫£o VirtualBox', 'fas fa-desktop')}"></div>
                
                <!-- Main card -->
                <div class="bg-white shadow-lg rounded-lg p-6">
                    <!-- Instructions Card -->
                    <div class="bg-gradient-to-r from-yellow-50 to-amber-50 border border-yellow-200 rounded-lg p-6 mb-6">
                        <div class="flex items-start">
                            <div class="flex-shrink-0">
                                <i class="fas fa-info-circle text-yellow-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <h4 class="text-lg font-bold text-yellow-800 mb-3">
                                    <i class="fas fa-exclamation-triangle mr-2"></i>
                                    L∆∞u √Ω s·ª≠ d·ª•ng
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-yellow-700">
                                    <div class="flex items-center">
                                        <i class="fas fa-check-circle text-yellow-600 mr-2"></i>
                                        ƒê·∫£m b·∫£o VirtualBox ƒë√£ ƒë∆∞·ª£c c√†i ƒë·∫∑t
                                    </div>
                                    <div class="flex items-center">
                                        <i class="fas fa-keyboard text-yellow-600 mr-2"></i>
                                        Nh·∫≠p ch√≠nh x√°c t√™n m√°y ·∫£o
                                    </div>
                                    <div class="flex items-center">
                                        <i class="fas fa-home text-yellow-600 mr-2"></i>
                                        Ch·ª©c nƒÉng n√†y ch·ªâ ho·∫°t ƒë·ªông tr√™n m√°y local
                                    </div>
                                    <div class="flex items-center">
                                        <i class="fas fa-search text-yellow-600 mr-2"></i>
                                        Ki·ªÉm tra tr·∫°ng th√°i m√°y ·∫£o tr∆∞·ªõc khi th·ª±c hi·ªán
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- VM Control Form -->
                    <form th:action="@{/vm-control}" method="post" class="space-y-6">
                        <!-- VM Name Input -->
                        <div class="space-y-2">
                            <label for="vmName" class="block text-sm font-semibold text-gray-700">
                                <i class="fas fa-desktop mr-2 text-indigo-600"></i>
                                T√™n m√°y ·∫£o:
                            </label>
                            <input type="text" 
                                   id="vmName" 
                                   name="vmName" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-200" 
                                   placeholder="V√≠ d·ª•: Ubuntu_VM, Windows_10_VM..."
                                   required>
                            <p class="text-xs text-gray-500 mt-1">
                                <i class="fas fa-lightbulb mr-1"></i>
                                Nh·∫≠p ch√≠nh x√°c t√™n m√°y ·∫£o nh∆∞ hi·ªÉn th·ªã trong VirtualBox Manager
                            </p>
                        </div>

                        <!-- Action Selection -->
                        <div class="space-y-2">
                            <label for="action" class="block text-sm font-semibold text-gray-700">
                                <i class="fas fa-cog mr-2 text-indigo-600"></i>
                                H√†nh ƒë·ªông:
                            </label>
                            <select id="action" 
                                    name="action" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-200">
                                <option value="start">
                                    üöÄ Kh·ªüi ƒë·ªông (Start) - B·∫≠t m√°y ·∫£o
                                </option>
                                <option value="shutdown">
                                    üîÑ T·∫Øt nh·∫π nh√†ng (Shutdown) - T·∫Øt an to√†n
                                </option>
                                <option value="poweroff">
                                    ‚ö° T·∫Øt ngay (Power Off) - T·∫Øt kh·∫©n c·∫•p
                                </option>
                                <option value="status">
                                    üìä Ki·ªÉm tra tr·∫°ng th√°i (Status) - Xem t√¨nh tr·∫°ng hi·ªán t·∫°i
                                </option>
                            </select>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex flex-col sm:flex-row gap-4 pt-6">
                            <a th:href="@{/dashboard}" 
                               class="flex items-center justify-center px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition duration-200 ease-in-out font-medium order-2 sm:order-1">
                                <i class="fas fa-arrow-left mr-2"></i>
                                Quay v·ªÅ Dashboard
                            </a>

                            <button type="submit" 
                                    class="flex items-center justify-center px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition duration-200 ease-in-out font-semibold shadow-lg order-1 sm:order-2 flex-1">
                                <i class="fas fa-play mr-2"></i>
                                Th·ª±c thi
                            </button>
                        </div>
                    </form>

                    <!-- Result Message -->
                    <div th:if="${message}" class="mt-6">
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg p-4">
                            <div class="flex items-center">
                                <i class="fas fa-check-circle text-green-600 text-xl mr-3"></i>
                                <div>
                                    <h4 class="font-semibold text-green-800">Th√†nh c√¥ng!</h4>
                                    <p class="text-green-700" th:text="${message}"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Error Message (if any) -->
                    <div th:if="${error}" class="mt-6">
                        <div class="bg-gradient-to-r from-red-50 to-pink-50 border border-red-200 rounded-lg p-4">
                            <div class="flex items-center">
                                <i class="fas fa-exclamation-triangle text-red-600 text-xl mr-3"></i>
                                <div>
                                    <h4 class="font-semibold text-red-800">L·ªói!</h4>
                                    <p class="text-red-700" th:text="${error}"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- VM Status Result (from form submission) -->
                    <div th:if="${status}" class="mt-6">
                        <div class="bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200 rounded-lg p-4">
                            <div class="flex items-center">
                                <i class="fas fa-info-circle text-blue-600 text-xl mr-3"></i>
                                <div>
                                    <h4 class="font-semibold text-blue-800">Tr·∫°ng th√°i m√°y ·∫£o</h4>
                                    <p class="text-blue-700" th:text="${status}"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Status Check Section -->
                    <div class="mt-8 border-t pt-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">
                            <i class="fas fa-search mr-2 text-indigo-600"></i>
                            Ki·ªÉm tra nhanh tr·∫°ng th√°i
                        </h3>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="text-sm text-gray-600 mb-3">
                                <i class="fas fa-info-circle mr-2"></i>
                                S·ª≠ d·ª•ng form ch√≠nh v·ªõi h√†nh ƒë·ªông "Ki·ªÉm tra tr·∫°ng th√°i" ƒë·ªÉ xem t√¨nh tr·∫°ng m√°y ·∫£o
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3 text-xs">
                                <div class="flex items-center p-2 bg-white rounded border">
                                    <i class="fas fa-play-circle text-green-600 mr-2"></i>
                                    <span><strong>Running:</strong> M√°y ·∫£o ƒëang ch·∫°y</span>
                                </div>
                                <div class="flex items-center p-2 bg-white rounded border">
                                    <i class="fas fa-stop-circle text-red-600 mr-2"></i>
                                    <span><strong>Poweroff:</strong> M√°y ·∫£o ƒë√£ t·∫Øt</span>
                                </div>
                                <div class="flex items-center p-2 bg-white rounded border">
                                    <i class="fas fa-pause-circle text-yellow-600 mr-2"></i>
                                    <span><strong>Saved:</strong> M√°y ·∫£o t·∫°m d·ª´ng</span>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="mt-8 border-t pt-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">
                            <i class="fas fa-terminal mr-2 text-indigo-600"></i>
                            Tham kh·∫£o l·ªánh VirtualBox
                        </h3>
                        <div class="bg-gray-900 text-green-400 rounded-lg p-4 text-sm font-mono">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <div class="text-gray-300 mb-2">üìã Danh s√°ch m√°y ·∫£o:</div>
                                    <div class="bg-gray-800 p-2 rounded">VBoxManage list vms</div>
                                </div>
                                <div>
                                    <div class="text-gray-300 mb-2">üìä Tr·∫°ng th√°i m√°y ·∫£o:</div>
                                    <div class="bg-gray-800 p-2 rounded">VBoxManage showvminfo [VM_NAME]</div>
                                </div>
                                <div>
                                    <div class="text-gray-300 mb-2">üöÄ Kh·ªüi ƒë·ªông m√°y ·∫£o:</div>
                                    <div class="bg-gray-800 p-2 rounded">VBoxManage startvm [VM_NAME]</div>
                                </div>
                                <div>
                                    <div class="text-gray-300 mb-2">‚ö° T·∫Øt m√°y ·∫£o:</div>
                                    <div class="bg-gray-800 p-2 rounded">VBoxManage controlvm [VM_NAME] poweroff</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <div th:replace="~{fragments/footer :: footer}"></div>

    <script>
        // Auto-update button text based on selected action
        document.getElementById('action').addEventListener('change', function() {
            const action = this.value;
            const button = document.querySelector('button[type="submit"]');
            const icon = button.querySelector('i');
            
            switch(action) {
                case 'start':
                    icon.className = 'fas fa-play mr-2';
                    button.innerHTML = '<i class="fas fa-play mr-2"></i>Kh·ªüi ƒë·ªông';
                    button.className = button.className.replace('bg-indigo-600 hover:bg-indigo-700', 'bg-green-600 hover:bg-green-700');
                    break;
                case 'shutdown':
                    icon.className = 'fas fa-power-off mr-2';
                    button.innerHTML = '<i class="fas fa-power-off mr-2"></i>T·∫Øt nh·∫π nh√†ng';
                    button.className = button.className.replace(/bg-\w+-600 hover:bg-\w+-700/g, 'bg-orange-600 hover:bg-orange-700');
                    break;
                case 'poweroff':
                    icon.className = 'fas fa-stop mr-2';
                    button.innerHTML = '<i class="fas fa-stop mr-2"></i>T·∫Øt ngay';
                    button.className = button.className.replace(/bg-\w+-600 hover:bg-\w+-700/g, 'bg-red-600 hover:bg-red-700');
                    break;
                case 'status':
                    icon.className = 'fas fa-search mr-2';
                    button.innerHTML = '<i class="fas fa-search mr-2"></i>Ki·ªÉm tra tr·∫°ng th√°i';
                    button.className = button.className.replace(/bg-\w+-600 hover:bg-\w+-700/g, 'bg-blue-600 hover:bg-blue-700');
                    break;
                default:
                    icon.className = 'fas fa-play mr-2';
                    button.innerHTML = '<i class="fas fa-play mr-2"></i>Th·ª±c thi';
                    button.className = button.className.replace(/bg-\w+-600 hover:bg-\w+-700/g, 'bg-indigo-600 hover:bg-indigo-700');
            }
        });

        // Form validation
        document.querySelector('form').addEventListener('submit', function(e) {
            const vmName = document.getElementById('vmName').value.trim();
            const action = document.getElementById('action').value;
            
            if (!vmName) {
                e.preventDefault();
                alert('Vui l√≤ng nh·∫≠p t√™n m√°y ·∫£o');
                return false;
            }
            
            // Confirmation for destructive actions
            if (action === 'poweroff') {
                if (!confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën t·∫Øt ngay m√°y ·∫£o?\n\nH√†nh ƒë·ªông n√†y c√≥ th·ªÉ g√¢y m·∫•t d·ªØ li·ªáu n·∫øu m√°y ·∫£o ƒëang ho·∫°t ƒë·ªông.')) {
                    e.preventDefault();
                    return false;
                }
            }
            
            // Show loading state
            const button = e.target.querySelector('button[type="submit"]');
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>ƒêang th·ª±c thi...';
            button.disabled = true;
            
            // Re-enable after timeout (in case something goes wrong)
            setTimeout(() => {
                button.innerHTML = originalText;
                button.disabled = false;
            }, 10000);
        });

        // Initialize button state
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('action').dispatchEvent(new Event('change'));
        });
    </script>
</body>
</html>
